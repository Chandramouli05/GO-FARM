<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Go-Farm planting</title>
  <!-- materialize icons, css & js -->
  <link type="text/css" href="/css/materialize.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link type="text/css" href="/css/style.css" rel="stylesheet">
  <script type="text/javascript" src="/js/materialize.min.js"></script>
  <link rel="manifest" href="/manifest.json">


  <!-- ios support-->
  <link rel="apple-touch-icon" href="/img/icons/96x96.png">
  <meta name="apple-mobile-web-app-status-bar" content="#aa7700">
  <meta name="theme-color" content="#FFE1C4">


</head>

<body class="grey lighten-4">

  <!-- top nav -->
  <nav class="z-depth-0">
    <div class="nav-wrapper container">
      <a href="/">Go<span>Farm</span></a>
      <span class="right grey-text text-darken-1">
        <i class="material-icons sidenav-trigger" data-target="side-menu">menu</i>
      </span>
    </div>
  </nav>

  <!-- side nav -->
  <ul id="side-menu" class="sidenav side-menu">
    <li><a class="subheader">Go-Farm</a></li>
    <li><a href="/" class="waves-effect">Home</a></li>
    <li><a href="/pages/about.html" class="waves-effect">About</a></li>
    <li>
      <div class="divider"></div>
    </li>
    <li><a href="/pages/contact.html" class="waves-effect">
        <i class="material-icons">mail_outline</i>Contact</a>
    </li>
   

  </ul>

  <!-- recipes -->
  <form id="myForm" action="#">
    <div class="recipes container grey-text text-darken-1">


    </div>

    

    <div class="card-panel recipe white row">
      <img src="/img/field.png" alt="recipe thumb">
      <input type="text" class="acre" placeholder="Farm Acre" id="farm_acre"></input>
    </div>

    <div class="card-panel recipe white row">
      <img src="/img/location.png" alt="recipe thumb">
      <input type="text" class="location" placeholder="Farm Location" id="farm_location"></input>

    </div>


    <div class="card-panel recipe white row">
      <img src="/img/drip.png" alt="recipe thumb">
      <input type="text" class="irrigation" placeholder="Water Irrigation" id="water_irrigation"></input>

    
    </div>


    <div class="card-panel recipe white row">
      <img src="/img/harvest.png" alt="recipe thumb">
      <input type="text" class="hcrop" placeholder="Harvesting Crop" id="h_crop"></input>

    </div>

    <div class="card-panel recipe white row">
      <img src="/img/calendar.png" alt="recipe thumb">
      <input type="date" class="date" placeholder="Date" id="date_field"></input>

    </div>

    
      




    <center>

      <button class="btn btn-danger" type="reset" value="Reset" style="background-color:red;" id="RstBtn"
        onclick="fun()">Reset</button>

      <button class="btn btn-success" style="background-color: #07da63;" id="SubBtn">Submit</button>
      
    </center>


    <!-- recipes -->
    <div class="recipes container grey-text text-darken-1">
      <div class="card-panel recipe white row">
        <img src="/img/calendar.png" alt="recipe thumb" href="#">
        <div class="recipe-details">
          <div class="recipe-title"><a href="/"></a></div>
          <label>View Harvesting Entry</label>
          <select class="browser-default" id="selectedMonth">
            <option value="00" selected>Choose the month</option>
            <option value="01">Janaury</option>
            <option value="02">February</option>
            <option value="03">March</option>
            <option value="04">April</option>
            <option value="05">May</option>
            <option value="06">June</option>
            <option value="07">July</option>
            <option value="08">August</option>
            <option value="09">September</option>
            <option value="10">October</option>
            <option value="11">November</option>
            <option value="12">December</option>
          </select>
        </div>
      </div>
    </div>

    <center>

      <button id="show" class="btn waves-effect waves-light"
        style="background-color:#07da63; margin-left: 150px;">Show</button>

    </center>



    <div class="recipes container grey-text text-darken-1" id="cardsContainer">

    </div>

  </form>
  </div>




  <script src="/js/app.js"></script>
  <script src="/js/jquery.min.js"></script>
  <script src="/js/ui.js"></script>
  <script src="/js/ui_planting.js"></script>




  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-app.js";
    import { getDatabase, set, ref, onValue } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-database.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-analytics.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
    apiKey: "AIzaSyD491wBvvFOjLDGbZVcg8I7GS2WudkO030",
    authDomain: "go-farm-a5ac8.firebaseapp.com",
    databaseURL: "https://go-farm-a5ac8-default-rtdb.firebaseio.com",
    projectId: "go-farm-a5ac8",
    storageBucket: "go-farm-a5ac8.appspot.com",
    messagingSenderId: "696360381034",
    appId: "1:696360381034:web:d12482efa872b87edaf813"
};
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);

    // Get a reference to the database service
    const database = getDatabase(app);


    //global variables
    var insertbtn = document.getElementById('SubBtn');
    var showbtn = document.getElementById('show');
    var showData = [];

    var harvestId;

    //*************************************************************************************************//



    insertbtn.addEventListener('click', function () {
      event.preventDefault()
      try {
        //Get element references
        // var userId = document.getElementById('user_id').value;
        var userId = 'user'
        var farmacre = document.getElementById('farm_acre').value;
        var location = document.getElementById('farm_location').value;
        var irrigation = document.getElementById('water_irrigation').value;
        var hcrop = document.getElementById('h_crop').value;
        var createDate = document.getElementById('date_field').value;
     
        if (!harvestId) {
          harvestId = Math.random().toString(36).slice(2);
        }


        //inserting data 
        set(ref(database, 'CreateHarvesting/' + userId + '/' + harvestId), {
          userId: userId,
          harvestId: harvestId,
          farmacre: farmacre,
          irrigation:irrigation,
          location: location,
          createDate: createDate,
          hcrop: hcrop
        });

        alert('New Harvesting created with id ' + harvestId + ' on user ' + userId)

        harvestId = '';


      }
      catch (err) {
        alert(error);
      }
    })

    showbtn.addEventListener('click', function () {

      var userId = 'user'

      alert('show clicked', userId)

      onValue(ref(database, 'CreateHarvesting/' + userId), (snapshot) => {

        const data = snapshot.val();

        console.log('data ----------------->', data);

        showData = Object.values(data)

        console.log(showData, '---------------------------------showData')

        showData = filterData(showData);

        if (showData.length == 0) {

        }
        else {
          createcards(showData);
        }
      });
    })

    function filterData(data) {
      var filterMonth = document.getElementById('selectedMonth').value;
      if (filterMonth == '00') {
        return data
      }
      else {
        var filteredDatas = []
        for (var i = 0; i < data.length; i++) {
          var createDate = String(showData[i].createDate);
          var month = createDate.substring(5, 7);
          if (filterMonth == month) {
            filteredDatas.push(data[i]);
          }
        }
        return filteredDatas;
      }
    }

    function editClicked(data) {

      document.getElementById('farm_acre').value = data.farmacre;
      document.getElementById('farm_location').value = data.location;
      document.getElementById('water_irrigation').value = data.irrigation;
      document.getElementById('date_field').value = data.createDate;
      document.getElementById('h_crop').value = data.hcrop;
      harvestId = data.harvestId;

    }

    function deleteClicked(userId,harvestId) {

      set(ref(database, 'CreateHarvesting/' + userId + '/' + harvestId), null);

      alert('Deleted crop ' + harvestId + ' on user ' + userId)

      harvestId = '';

    }





    //*************************************************************************************************//


    function createcards(filterArray) {

      let tagsamp = ``;

      filterArray.forEach((obj) => {

        console.log(obj, '---------------------------------obj')


        let card = ` <div class="card-panel recipe white row" style="height: 200px;">

        <div class="recipe-details">
          <div class="recipe-title"><a href="/"></a></div>


          <label style="font-size: larger;">Plant Name:</label>
          <a style="font-size: larger;">${obj.farmacre}</a>
          <br>

          <label style="font-size: larger;">No. of plants:</label>
          <a style="font-size: larger;">${obj.location}</a>
          <br>

          <label style="font-size: larger;">Water Irrigation:</label>
          <a style="font-size: larger;">${obj.irrigation}</a>
          <br>

          <label style="font-size: larger;">Date:</label>
          <a style="font-size: larger;">${obj.createDate}</a>
          <br>

          <label style="font-size: larger;">Harvesting Crop:</label>
          <a style="font-size: larger;">${obj.hcrop}</a>
          <br>
          <br>
          <center style="margin-left: -50;">

            <button class="btn btn-danger deletebtn" id='del${obj.harvestId}'    style="background-color:red;">Delete</button>

            <button class="btn btn-success editbtn" id='edit${obj.harvestId}'   style="background-color: #07da63;">Edit</button>


          </center>
        </div>
        </div>`


        tagsamp = tagsamp + card;

       

      })

      document.getElementById('cardsContainer').innerHTML = tagsamp;

      filterArray.forEach((obj)=>{
        document.getElementById('del'+obj.harvestId).onclick = function(){console.log('obj ----------------->', obj); deleteClicked(obj.userId, obj.harvestId)}
        document.getElementById('edit'+obj.harvestId).onclick = function(){console.log('obj ----------------->', obj); editClicked(obj)}
      })
    }








    // function createDataContainer() {
    //   var dataContainer = document.createElement("div");
    //   dataContainer.className = 'data-container main-div'
    //   dataContainer.setAttribute('id', 'data-container');

    //   var displaydiv = document.getElementById('display-div');
    //   displaydiv.appendChild(dataContainer);

    // }

    // function createDataCard(data) {

    //   var card = document.createElement("div");
    //   card.setAttribute('id', 'card')

    //   var para = document.createElement("p");
    //   var node = document.createTextNode(data.farmacre);
    //   para.appendChild(node);
    //   card.appendChild(para);

    //   var date = document.createElement("p");
    //   var datenode = document.createTextNode(data.createDate);
    //   date.appendChild(datenode);
    //   card.appendChild(date);

    //   let btn = document.createElement("button");
    //   btn.innerHTML = "Edit";
    //   btn.type = "button";
    //   btn.name = "editBtn";
    //   btn.onclick = function () {
    //     editClicked(data);
    //   };
    //   card.appendChild(btn);

    //   btn = document.createElement("button");
    //   btn.innerHTML = "Delete";
    //   btn.type = "button";
    //   btn.name = "deleteBtn";
    //   btn.onclick = function () {
    //     deleteClicked(data);
    //   };
    //   card.appendChild(btn);

    //   var br = document.createElement("br");
    //   card.appendChild(br);

    //   var dataContainer = document.getElementById("data-container");
    //   dataContainer.appendChild(card);
    // }


    // function createNotFoundMessage() {
    //   var card = document.createElement("div");
    //   card.setAttribute('name', 'card')

    //   var para = document.createElement("p");
    //   var node = document.createTextNode('No Data Found on Selected Month');
    //   para.appendChild(node);
    //   card.appendChild(para);

    //   var dataContainer = document.getElementById("data-container");
    //   dataContainer.appendChild(card);

    // }

    // function removePreviosCards() {
    //   var card = document.getElementById('data-container');
    //   console.log(card)
    //   card.remove();
    // }




    //*************************************************************************************************//





  </script>



</body>

</html>