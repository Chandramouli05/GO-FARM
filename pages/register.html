<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">

  <title>Go-Farm Sign-in</title>
  <!-- CSS only -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      width: 100vw;
      margin: 0px;
    }
  </style>
</head>

<body>


  <div class="card" style="margin-left:50px; margin-right:50px;">
    <div class="mb-5">
      <h3 class="mb-3">Sign Up</h3>
      <input type="text" placeholder="Full name" id="nameInp" class="form-control mb-3">
      <input type="email" placeholder="Enter your mail" id="emailInp" class="form-control mb-3">
      <input type="text" placeholder="Username" id="userInp" class="form-control mb-3">
      <input type="password" placeholder="password" id="passInp" class="form-control mb-3">
      <button type="text" id="sub_btn" class="btn w-100 btn-outline-success mb-3">Sign up</button>
      <a href="login.html" class="badge text-bg-secondary py-1 w-100">Already Have An Account?</a>
    </div>
  </div>
  <script type="module">
    //------------------------------FIREBASE CONFIG-------------------------------//

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.3/firebase-app.js";


    const firebaseConfig = {
      apiKey: "AIzaSyBOTx3uEiCVkahTObiCTGGyEoyqLRQ814o",
      authDomain: "go-farm-3fed3.firebaseapp.com",
      databaseURL: "https://go-farm-3fed3-default-rtdb.firebaseio.com",
      projectId: "go-farm-3fed3",
      storageBucket: "go-farm-3fed3.appspot.com",
      messagingSenderId: "281597592806",
      appId: "1:281597592806:web:daf855d0e975277ce6a727",
      measurementId: "G-V2XHBPHRF8"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);

    import { getDatabase, ref, set, child, get }
      from "https://www.gstatic.com/firebasejs/9.6.3/firebase-database.js";

    const db = getDatabase();

    //-------------------------------------The references-------------------//

    const name = document.getElementById('nameInp');
    const email = document.getElementById('emailInp');
    const username = document.getElementById('userInp');
    const pass = document.getElementById('passInp');
    const submit = document.getElementById('sub_btn');

    //-----------VALIDATION----------- //

    function isEmptyOrSpaces(str) {

      return str == null || str.match(/^ *$/) !== null;
    }

    function Validation() {

      let nameregex = /^[a-zA-Z]+$/;
      let email = /^[a-zA-Z0-9]+@(gmail|yahoo|outlook)\.com$/;
      let userregex = /^[a-zA-Z0-9]{5,}$/;

      if (isEmptyOrSpaces(name.value) || isEmptyOrSpaces(email.value) || isEmptyOrSpaces(username.value) || isEmptyOrSpaces(pass.value) || isEmptyOrSpaces(cpass.value)) {

        alert("You cannot left any field empty");
        return false;
      }


      if (!nameregex.test(name.value)) {
        alert("The name should only contain alphabets!");
        return false;

      }

      if (!email.test(email.value)) {
        alert("Enter a valid email");
        return false;
      }

      if (!userregex.test(username.value)) {
        alert("-username can only be alphanumeric\n-username must be atleast 5 characters\n-username cannot contain spaces");
        return false;
      }

      return true;

    }

    //--------------REGISTER USER TO FIREBASE---------------//

    function Registeruser() {
      if (!Validation()) {

        return;
      };

      const dbref = ref(db);

      get(child(dbref, "UsersList/" + username.value)).then((snapshot) => {
        if (snapshot.exists()) {
          alert("Account Already Exist!");
        }

        else {
          set(ref(db, "UsersList/" + username.value),
            {
              fullname: name.value,
              email: email.value,
              username: username.value,
              password: encPass(),

            })
            .then(() => {

              alert("user added successfully!");
            })
            .catch((error) => {
              alert("error" + error);
            })
        }
      });
    }
    //----------------------------ENCRYPTION-------------------------//

    function encPass() {
      var pass12 = cryptoJS.AES.encrypt(pass.value, pass.value);
      return pass12.toString();
    }

    //----------------------ASSIGN THE EVENTS----------------//

    submit.addEventListener('click', Registeruser);

  </script>


</body>

</html>